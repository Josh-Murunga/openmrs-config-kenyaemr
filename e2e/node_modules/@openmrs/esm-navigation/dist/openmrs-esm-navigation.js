System.register(["@openmrs/esm-state"],(function(t,e){var n={};return{setters:[function(t){n.createGlobalStore=t.createGlobalStore}],execute:function(){t((()=>{"use strict";var t={685:t=>{t.exports=n}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{function t(t){return t.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function e(t){return t&&t.sensitive?"":"i"}function n(n,r,o){return function(n,r,o){void 0===o&&(o={});for(var i=o.strict,a=void 0!==i&&i,s=o.start,u=void 0===s||s,c=o.end,l=void 0===c||c,f=o.encode,p=void 0===f?function(t){return t}:f,h="["+t(o.endsWith||"")+"]|$",m="["+t(o.delimiter||"/#?")+"]",d=u?"^":"",w=0,g=n;w<g.length;w++){var v=g[w];if("string"==typeof v)d+=t(p(v));else{var y=t(p(v.prefix)),E=t(p(v.suffix));if(v.pattern)if(r&&r.push(v),y||E)if("+"===v.modifier||"*"===v.modifier){var b="*"===v.modifier?"?":"";d+="(?:"+y+"((?:"+v.pattern+")(?:"+E+y+"(?:"+v.pattern+"))*)"+E+")"+b}else d+="(?:"+y+"("+v.pattern+")"+E+")"+v.modifier;else d+="("+v.pattern+")"+v.modifier;else d+="(?:"+y+E+")"+v.modifier}}if(l)a||(d+=m+"?"),d+=o.endsWith?"(?="+h+")":"$";else{var O=n[n.length-1],P="string"==typeof O?m.indexOf(O[O.length-1])>-1:void 0===O;a||(d+="(?:"+m+"(?="+h+"))?"),P||(d+="(?="+m+"|"+h+")")}return new RegExp(d,e(o))}(function(e,n){void 0===n&&(n={});for(var r=function(t){for(var e=[],n=0;n<t.length;){var r=t[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)e.push({type:"CHAR",index:n,value:t[n++]});else{var o=1,i="";if("?"===t[s=n+1])throw new TypeError('Pattern cannot start with "?" at '+s);for(;s<t.length;)if("\\"!==t[s]){if(")"===t[s]){if(0==--o){s++;break}}else if("("===t[s]&&(o++,"?"!==t[s+1]))throw new TypeError("Capturing groups are not allowed at "+s);i+=t[s++]}else i+=t[s++]+t[s++];if(o)throw new TypeError("Unbalanced pattern at "+n);if(!i)throw new TypeError("Missing pattern at "+n);e.push({type:"PATTERN",index:n,value:i}),n=s}else{for(var a="",s=n+1;s<t.length;){var u=t.charCodeAt(s);if(!(u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||95===u))break;a+=t[s++]}if(!a)throw new TypeError("Missing parameter name at "+n);e.push({type:"NAME",index:n,value:a}),n=s}else e.push({type:"CLOSE",index:n,value:t[n++]});else e.push({type:"OPEN",index:n,value:t[n++]});else e.push({type:"ESCAPED_CHAR",index:n++,value:t[n++]});else e.push({type:"MODIFIER",index:n,value:t[n++]})}return e.push({type:"END",index:n,value:""}),e}(e),o=n.prefixes,i=void 0===o?"./":o,a="[^"+t(n.delimiter||"/#?")+"]+?",s=[],u=0,c=0,l="",f=function(t){if(c<r.length&&r[c].type===t)return r[c++].value},p=function(t){var e=f(t);if(void 0!==e)return e;var n=r[c],o=n.type,i=n.index;throw new TypeError("Unexpected "+o+" at "+i+", expected "+t)},h=function(){for(var t,e="";t=f("CHAR")||f("ESCAPED_CHAR");)e+=t;return e};c<r.length;){var m=f("CHAR"),d=f("NAME"),w=f("PATTERN");if(d||w){var g=m||"";-1===i.indexOf(g)&&(l+=g,g=""),l&&(s.push(l),l=""),s.push({name:d||u++,prefix:g,suffix:"",pattern:w||a,modifier:f("MODIFIER")||""})}else{var v=m||f("ESCAPED_CHAR");if(v)l+=v;else if(l&&(s.push(l),l=""),f("OPEN")){g=h();var y=f("NAME")||"",E=f("PATTERN")||"",b=h();p("CLOSE"),s.push({name:y||(E?u++:""),pattern:y&&!E?a:E,prefix:g,suffix:b,modifier:f("MODIFIER")||""})}else p("END")}}return s}(n,o),r,o)}function i(t,r,o){return t instanceof RegExp?function(t,e){if(!e)return t;var n=t.source.match(/\((?!\?)/g);if(n)for(var r=0;r<n.length;r++)e.push({name:r,prefix:"",suffix:"",modifier:"",pattern:""});return t}(t,r):Array.isArray(t)?function(t,n,r){var o=t.map((function(t){return i(t,n,r).source}));return new RegExp("(?:"+o.join("|")+")",e(r))}(t,r,o):n(t,r,o)}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function s(t){return function(t){if(Array.isArray(t))return a(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return a(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}r.r(o),r.d(o,{clearHistory:()=>fe,filterBreadcrumbs:()=>d,getBreadcrumbs:()=>p,getBreadcrumbsFor:()=>w,getHistory:()=>ce,goBackInHistory:()=>le,interpolateString:()=>oe,interpolateUrl:()=>re,navigate:()=>ie,registerBreadcrumb:()=>l,registerBreadcrumbs:()=>f,setupHistory:()=>ue});var u=(0,r(685).createGlobalStore)("breadcrumbs",[]);function c(t){return e=t.matcher,(null!=(n=RegExp)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](e):e instanceof n)?t.matcher:"string"==typeof t.matcher?i(t.matcher):i(t.path);var e,n}function l(t){return f([t])}function f(t){var e=p(),n=t.map((function(t){return{matcher:c(t),settings:t}})),r=s(e).concat(s(n));u.setState(r,!0)}function p(){return u.getState()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function m(t,e){if(e)return function(t,e){var n=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i=[],a=!0,s=!1;try{for(n=n.call(t);!(a=(r=n.next()).done)&&(i.push(r.value),!e||i.length!==e);a=!0);}catch(t){s=!0,o=t}finally{try{a||null==n.return||n.return()}finally{if(s)throw o}}return i}}(t,e)||function(t,e){if(t){if("string"==typeof t)return h(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.filter((function(t){return t.matcher.test(e)})),1);return n[0]}(t,e)||function(t,e){for(var n=e.split("/");n.length>1;){n.pop();var r=m(t,n.join("/"));if(r)return r}}(t,e)}function d(t,e){if(t.length>0){var n=m(t,e);if(n){for(var r=[n],o=m(t,n.settings.parent);void 0!==o;)r.push(o),o=m(t,o.settings.parent);return r.reverse()}}return[]}function w(t){return d(p(),t)}var g=Object.freeze({__proto__:null,get start(){return Zt},get ensureJQuerySupport(){return Nt},get setBootstrapMaxTime(){return st},get setMountMaxTime(){return ut},get setUnmountMaxTime(){return ct},get setUnloadMaxTime(){return lt},get registerApplication(){return Bt},get unregisterApplication(){return Wt},get getMountedApps(){return Rt},get getAppStatus(){return Lt},get unloadApplication(){return Ht},get checkActivityFunctions(){return Gt},get getAppNames(){return $t},get pathToActiveWhen(){return Ft},get navigateToUrl(){return gt},get patchHistoryApi(){return Tt},get triggerAppChange(){return qt},get addErrorHandler(){return O},get removeErrorHandler(){return P},get mountRootParcel(){return nt},get NOT_LOADED(){return A},get LOADING_SOURCE_CODE(){return N},get NOT_BOOTSTRAPPED(){return x},get BOOTSTRAPPING(){return j},get NOT_MOUNTED(){return _},get MOUNTING(){return D},get UPDATING(){return M},get LOAD_ERROR(){return $},get MOUNTED(){return I},get UNLOADING(){return R},get UNMOUNTING(){return U},get SKIP_BECAUSE_BROKEN(){return L}}),v=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{}).CustomEvent,y=function(){try{var t=new v("cat",{detail:{foo:"bar"}});return"cat"===t.type&&"bar"===t.detail.foo}catch(t){}return!1}()?v:"undefined"!=typeof document&&"function"==typeof document.createEvent?function(t,e){var n=document.createEvent("CustomEvent");return e?n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail):n.initCustomEvent(t,!1,!1,void 0),n}:function(t,e){var n=document.createEventObject();return n.type=t,e?(n.bubbles=Boolean(e.bubbles),n.cancelable=Boolean(e.cancelable),n.detail=e.detail):(n.bubbles=!1,n.cancelable=!1,n.detail=void 0),n};let E=[];function b(t,e,n){const r=S(t,e,n);E.length?E.forEach((t=>t(r))):setTimeout((()=>{throw r}))}function O(t){if("function"!=typeof t)throw Error(T(28,!1));E.push(t)}function P(t){if("function"!=typeof t)throw Error(T(29,!1));let e=!1;return E=E.filter((n=>{const r=n===t;return e=e||r,!r})),e}function T(t,e,...n){return`single-spa minified message #${t}: ${e?e+" ":""}See https://single-spa.js.org/error/?code=${t}${n.length?`&arg=${n.join("&arg=")}`:""}`}function S(t,e,n){const r=`${H(e)} '${G(e)}' died in status ${e.status}: `;let o;if(t instanceof Error){try{t.message=r+t.message}catch(t){}o=t}else{console.warn(T(30,!1,e.status,G(e)));try{o=Error(r+JSON.stringify(t))}catch(e){o=t}}return o.appOrParcelName=G(e),e.status=n,o}const A="NOT_LOADED",N="LOADING_SOURCE_CODE",x="NOT_BOOTSTRAPPED",j="BOOTSTRAPPING",_="NOT_MOUNTED",D="MOUNTING",I="MOUNTED",M="UPDATING",U="UNMOUNTING",R="UNLOADING",$="LOAD_ERROR",L="SKIP_BECAUSE_BROKEN";function C(t){return t.status===I}function B(t){try{return t.activeWhen(window.location)}catch(e){return b(e,t,L),!1}}function G(t){return t.name}function W(t){return Boolean(t.unmountThisParcel)}function H(t){return W(t)?"parcel":"application"}function k(){for(let t=arguments.length-1;t>0;t--)for(let e in arguments[t])"__proto__"!==e&&(arguments[t-1][e]=arguments[t][e]);return arguments[0]}function J(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return t[n];return null}function F(t){return t&&("function"==typeof t||(e=t,Array.isArray(e)&&!J(e,(t=>"function"!=typeof t))));var e}function K(t,e){let n=t[e]||[];n=Array.isArray(n)?n:[n],0===n.length&&(n=[()=>Promise.resolve()]);const r=H(t),o=G(t);return function(t){return n.reduce(((n,i,a)=>n.then((()=>{const n=i(t);return Q(n)?n:Promise.reject(T(15,!1,r,o,e,a))}))),Promise.resolve())}}function Q(t){return t&&"function"==typeof t.then&&"function"==typeof t.catch}let V=[];function q(t,e){return Promise.resolve().then((()=>t.status!==x?t:(t.status=j,t.bootstrap?ft(t,"bootstrap").then(n).catch((n=>{if(e)throw S(n,t,L);return b(n,t,L),t})):Promise.resolve().then(n))));function n(){return t.status=_,t}}function z(t,e){return Promise.resolve().then((()=>{if(t.status!==I)return t;t.status=U;const n=Object.keys(t.parcels).map((e=>t.parcels[e].unmountThisParcel()));return Promise.all(n).then(r,(n=>r().then((()=>{const r=Error(n.message);if(e)throw S(r,t,L);b(r,t,L)})))).then((()=>t));function r(){return ft(t,"unmount").then((()=>{t.status=_}),(n=>{if(e)throw S(n,t,L);b(n,t,L)}))}}))}let X=!1,Y=!1;function Z(t,e){return Promise.resolve().then((()=>t.status!==_?t:(X||(window.dispatchEvent(new y("single-spa:before-first-mount")),X=!0),t.status=D,ft(t,"mount").then((()=>(t.status=I,Y||(window.dispatchEvent(new y("single-spa:first-mount")),Y=!0),t))).catch((n=>{return t.status=I,z(t,!0).then(r,r);function r(){if(e)throw S(n,t,L);return b(n,t,L),t}})))))}let tt=0;const et={parcels:{}};function nt(){return rt.apply(et,arguments)}function rt(t,e){const n=this;if(!t||"object"!=typeof t&&"function"!=typeof t)throw Error(T(2,!1));if(t.name&&"string"!=typeof t.name)throw Error(T(3,!1,typeof t.name));const r=tt++;let o=t.name||`parcel-${r}`;if("object"!=typeof e)throw Error(T(4,!1,o,typeof e));if(!e.domElement)throw Error(T(5,!1,o));const i="function"==typeof t,a=i?t:()=>Promise.resolve(t),s={id:r,parcels:{},status:i?N:x,customProps:e,parentName:G(n),unmountThisParcel:()=>f.then((()=>{if(s.status!==I)throw Error(T(6,!1,o,s.status));return z(s,!0)})).then((t=>(s.parentName&&delete n.parcels[s.id],t))).then((t=>(p(t),t))).catch((t=>{throw s.status=L,h(t),t}))};let u;n.parcels[r]=s;let c=a();if(!c||"function"!=typeof c.then)throw Error(T(7,!1));c=c.then((t=>{if(!t)throw Error(T(8,!1));if(o=t.name||`parcel-${r}`,Object.prototype.hasOwnProperty.call(t,"bootstrap")&&!F(t.bootstrap))throw Error(T(9,!1,o));if(!F(t.mount))throw Error(T(10,!1,o));if(!F(t.unmount))throw Error(T(11,!1,o));if(t.update&&!F(t.update))throw Error(T(12,!1,o));const e=K(t,"bootstrap"),n=K(t,"mount"),i=K(t,"unmount");s.status=x,s.name=o,s.bootstrap=e,s.mount=n,s.unmount=i,s.timeouts=pt(t.timeouts),t.update&&(s.update=K(t,"update"),u.update=function(t){return s.customProps=t,ot((e=s,Promise.resolve().then((()=>{if(e.status!==I)throw Error(T(32,!1,G(e)));return e.status=M,ft(e,"update").then((()=>(e.status=I,e))).catch((t=>{throw S(t,e,L)}))}))));var e})}));const l=c.then((()=>q(s,!0))),f=l.then((()=>Z(s,!0)));let p,h;const m=new Promise(((t,e)=>{p=t,h=e}));return u={mount:()=>ot(Promise.resolve().then((()=>{if(s.status!==_)throw Error(T(13,!1,o,s.status));return n.parcels[r]=s,Z(s)}))),unmount:()=>ot(s.unmountThisParcel()),getStatus:()=>s.status,loadPromise:ot(c),bootstrapPromise:ot(l),mountPromise:ot(f),unmountPromise:ot(m)},u}function ot(t){return t.then((()=>null))}function it(t){const e=G(t);let n="function"==typeof t.customProps?t.customProps(e,window.location):t.customProps;("object"!=typeof n||null===n||Array.isArray(n))&&(n={},console.warn(T(40,!1),e,n));const r=k({},n,{name:e,mountParcel:rt.bind(t),singleSpa:g});return W(t)&&(r.unmountSelf=t.unmountThisParcel),r}const at={bootstrap:{millis:4e3,dieOnTimeout:!1,warningMillis:1e3},mount:{millis:3e3,dieOnTimeout:!1,warningMillis:1e3},unmount:{millis:3e3,dieOnTimeout:!1,warningMillis:1e3},unload:{millis:3e3,dieOnTimeout:!1,warningMillis:1e3},update:{millis:3e3,dieOnTimeout:!1,warningMillis:1e3}};function st(t,e,n){if("number"!=typeof t||t<=0)throw Error(T(16,!1));at.bootstrap={millis:t,dieOnTimeout:e,warningMillis:n||1e3}}function ut(t,e,n){if("number"!=typeof t||t<=0)throw Error(T(17,!1));at.mount={millis:t,dieOnTimeout:e,warningMillis:n||1e3}}function ct(t,e,n){if("number"!=typeof t||t<=0)throw Error(T(18,!1));at.unmount={millis:t,dieOnTimeout:e,warningMillis:n||1e3}}function lt(t,e,n){if("number"!=typeof t||t<=0)throw Error(T(19,!1));at.unload={millis:t,dieOnTimeout:e,warningMillis:n||1e3}}function ft(t,e){const n=t.timeouts[e],r=n.warningMillis,o=H(t);return new Promise(((i,a)=>{let s=!1,u=!1;t[e](it(t)).then((t=>{s=!0,i(t)})).catch((t=>{s=!0,a(t)})),setTimeout((()=>l(1)),r),setTimeout((()=>l(!0)),n.millis);const c=T(31,!1,e,o,G(t),n.millis);function l(t){if(!s)if(!0===t)u=!0,n.dieOnTimeout?a(Error(c)):console.error(c);else if(!u){const e=t,o=e*r;console.warn(c),o+r<n.millis&&setTimeout((()=>l(e+1)),r)}}}))}function pt(t){const e={};for(let n in at)e[n]=k({},at[n],t&&t[n]||{});return e}function ht(t){return Promise.resolve().then((()=>{if(t.loadPromise)return t.loadPromise;if(t.status!==A&&t.status!==$)return t;let e,n;return t.status=N,t.loadPromise=Promise.resolve().then((()=>{const r=t.loadApp(it(t));if(!Q(r))throw n=!0,Error(T(33,!1,G(t)));return r.then((n=>{let r;t.loadErrorTime=null,e=n,"object"!=typeof e&&(r=34),Object.prototype.hasOwnProperty.call(e,"bootstrap")&&!F(e.bootstrap)&&(r=35),F(e.mount)||(r=36),F(e.unmount)||(r=37);const o=H(e);if(r){let n;try{n=JSON.stringify(e)}catch(t){}return console.error(T(r,!1,o,G(t),n),e),b(void 0,t,L),t}return e.devtools&&e.devtools.overlays&&(t.devtools.overlays=k({},t.devtools.overlays,e.devtools.overlays)),t.status=x,t.bootstrap=K(e,"bootstrap"),t.mount=K(e,"mount"),t.unmount=K(e,"unmount"),t.unload=K(e,"unload"),t.timeouts=pt(e.timeouts),delete t.loadPromise,t}))})).catch((e=>{let r;return delete t.loadPromise,n?r=L:(r=$,t.loadErrorTime=(new Date).getTime()),b(e,t,r),t}))}))}const mt="undefined"!=typeof window,dt={hashchange:[],popstate:[]},wt=["hashchange","popstate"];function gt(t){let e;if("string"==typeof t)e=t;else if(this&&this.href)e=this.href;else{if(!(t&&t.currentTarget&&t.currentTarget.href&&t.preventDefault))throw Error(T(14,!1));e=t.currentTarget.href,t.preventDefault()}const n=St(window.location.href),r=St(e);0===e.indexOf("#")?window.location.hash=r.hash:n.host!==r.host&&r.host?window.location.href=e:r.pathname===n.pathname&&r.search===n.search?window.location.hash=r.hash:window.history.pushState(null,null,e)}function vt(t){if(t){const e=t[0].type;wt.indexOf(e)>=0&&dt[e].forEach((e=>{try{e.apply(this,t)}catch(t){setTimeout((()=>{throw t}))}}))}}let yt;function Et(){zt([],arguments)}function bt(t,e){return function(){const n=window.location.href,r=t.apply(this,arguments),o=window.location.href;return yt&&n===o||window.dispatchEvent(function(t,e){let n;try{n=new PopStateEvent("popstate",{state:t})}catch(e){n=document.createEvent("PopStateEvent"),n.initPopStateEvent("popstate",!1,!1,t)}return n.singleSpa=!0,n.singleSpaTrigger=e,n}(window.history.state,e)),r}}let Ot=null,Pt=!1;function Tt(t){if(Pt)throw Error(T(43,!1));yt=!t||!t.hasOwnProperty("urlRerouteOnly")||t.urlRerouteOnly,Pt=!0,Ot=window.history.replaceState,window.addEventListener("hashchange",Et),window.addEventListener("popstate",Et);const e=window.addEventListener,n=window.removeEventListener;window.addEventListener=function(t,n){if(!("function"==typeof n&&wt.indexOf(t)>=0)||J(dt[t],(t=>t===n)))return e.apply(this,arguments);dt[t].push(n)},window.removeEventListener=function(t,e){if(!("function"==typeof e&&wt.indexOf(t)>=0))return n.apply(this,arguments);dt[t]=dt[t].filter((t=>t!==e))},window.history.pushState=bt(window.history.pushState,"pushState"),window.history.replaceState=bt(Ot,"replaceState")}function St(t){const e=document.createElement("a");return e.href=t,e}mt&&(window.singleSpaNavigate?console.warn(T(41,!1)):window.singleSpaNavigate=gt);let At=!1;function Nt(t=window.jQuery){if(t||window.$&&window.$.fn&&window.$.fn.jquery&&(t=window.$),t&&!At){const e=t.fn.on,n=t.fn.off;t.fn.on=function(t,n){return xt.call(this,e,window.addEventListener,t,n,arguments)},t.fn.off=function(t,e){return xt.call(this,n,window.removeEventListener,t,e,arguments)},At=!0}}function xt(t,e,n,r,o){return"string"!=typeof n?t.apply(this,o):(n.split(/\s+/).forEach((t=>{wt.indexOf(t)>=0&&(e(t,r),n=n.replace(t,""))})),""===n.trim()?this:t.apply(this,o))}const jt={};function _t(t){return Promise.resolve().then((()=>{const e=jt[G(t)];if(!e)return t;if(t.status===A)return Dt(t,e),t;if(t.status===R)return e.promise.then((()=>t));if(t.status!==_&&t.status!==$)return t;const n=t.status===$?Promise.resolve():ft(t,"unload");return t.status=R,n.then((()=>(Dt(t,e),t))).catch((n=>(function(t,e,n){delete jt[G(t)],delete t.bootstrap,delete t.mount,delete t.unmount,delete t.unload,b(n,t,L),e.reject(n)}(t,e,n),t)))}))}function Dt(t,e){delete jt[G(t)],delete t.bootstrap,delete t.mount,delete t.unmount,delete t.unload,t.status=A,e.resolve()}function It(t,e,n,r){jt[G(t)]={app:t,resolve:n,reject:r},Object.defineProperty(jt[G(t)],"promise",{get:e})}function Mt(t){return jt[t]}const Ut=[];function Rt(){return Ut.filter(C).map(G)}function $t(){return Ut.map(G)}function Lt(t){const e=J(Ut,(e=>G(e)===t));return e?e.status:null}let Ct=!1;function Bt(t,e,n,r){const o=function(t,e,n,r){const o={name:null,loadApp:null,activeWhen:null,customProps:null};return"object"==typeof t?(function(t){if(Array.isArray(t)||null===t)throw Error(T(39,!1));const e=["name","app","activeWhen","customProps"],n=Object.keys(t).reduce(((t,n)=>e.indexOf(n)>=0?t:t.concat(n)),[]);if(0!==n.length)throw Error(T(38,!1,e.join(", "),n.join(", ")));if("string"!=typeof t.name||0===t.name.length)throw Error(T(20,!1));if("object"!=typeof t.app&&"function"!=typeof t.app)throw Error(T(20,!1));const r=t=>"string"==typeof t||"function"==typeof t;if(!(r(t.activeWhen)||Array.isArray(t.activeWhen)&&t.activeWhen.every(r)))throw Error(T(24,!1));if(!Jt(t.customProps))throw Error(T(22,!1))}(t),o.name=t.name,o.loadApp=t.app,o.activeWhen=t.activeWhen,o.customProps=t.customProps):(function(t,e,n,r){if("string"!=typeof t||0===t.length)throw Error(T(20,!1));if(!e)throw Error(T(23,!1));if("function"!=typeof n)throw Error(T(24,!1));if(!Jt(r))throw Error(T(22,!1))}(t,e,n,r),o.name=t,o.loadApp=e,o.activeWhen=n,o.customProps=r),o.loadApp="function"!=typeof(i=o.loadApp)?()=>Promise.resolve(i):i,o.customProps=function(t){return t||{}}(o.customProps),o.activeWhen=function(t){let e=Array.isArray(t)?t:[t];return e=e.map((t=>"function"==typeof t?t:Ft(t))),t=>e.some((e=>e(t)))}(o.activeWhen),o;var i}(t,e,n,r);if(te()||Ct||(Ct=!0,setTimeout((()=>{te()||console.warn(T(1,!1))}),5e3)),-1!==$t().indexOf(o.name))throw Error(T(21,!1,o.name));Ut.push(k({loadErrorTime:null,status:A,parcels:{},devtools:{overlays:{options:{},selectors:[]}}},o)),mt&&(Nt(),zt())}function Gt(t=window.location){return Ut.filter((e=>e.activeWhen(t))).map(G)}function Wt(t){if(0===Ut.filter((e=>G(e)===t)).length)throw Error(T(25,!1,t));return(mt?Ht(t,{waitForUnmount:!1}):Promise.resolve()).then((()=>{const e=Ut.map(G).indexOf(t);Ut.splice(e,1)}))}function Ht(t,e={waitForUnmount:!1}){if("string"!=typeof t)throw Error(T(26,!1));const n=J(Ut,(e=>G(e)===t));if(!n)throw Error(T(27,!1,t));const r=Mt(G(n));if(e&&e.waitForUnmount){if(r)return r.promise;{const t=new Promise(((e,r)=>{It(n,(()=>t),e,r)}));return t}}{let t;return r?(t=r.promise,kt(n,r.resolve,r.reject)):t=new Promise(((e,r)=>{It(n,(()=>t),e,r),kt(n,e,r)})),t}}function kt(t,e,n){Promise.resolve().then((()=>{if(J(Gt(),(e=>e===G(t))))return qt()})).then((()=>z(t).then(_t).then((()=>{e(),setTimeout((()=>{zt()}))})))).catch(n)}function Jt(t){return!t||"function"==typeof t||"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ft(t,e){const n=function(t,e){let n=0,r=!1,o="^";"/"!==t[0]&&(t="/"+t);for(let e=0;e<t.length;e++){const n=t[e];(!r&&":"===n||r&&"/"===n)&&i(e)}return i(t.length),new RegExp(o,"i");function i(i){const a=t.slice(n,i).replace(/[|\\{}()[\]^$+*?.]/g,"\\$&");if(o+=r?"[^/]+/?":a,i===t.length)if(r)e&&(o+="$");else{const t=e?"":".*";o="/"===o.charAt(o.length-1)?`${o}${t}$`:`${o}(/${t})?(#.*)?$`}r=!r,n=i}}(t,e);return t=>{let e=t.origin;e||(e=`${t.protocol}//${t.host}`);const r=t.href.replace(e,"").replace(t.search,"").split("?")[0];return n.test(r)}}let Kt=!1,Qt=[],Vt=mt&&window.location.href;function qt(){return zt()}function zt(t=[],e,n=!1){if(Kt)return new Promise(((t,n)=>{Qt.push({resolve:t,reject:n,eventArguments:e})}));const{appsToUnload:r,appsToUnmount:o,appsToLoad:i,appsToMount:a}=function(){const t=[],e=[],n=[],r=[],o=(new Date).getTime();return Ut.forEach((i=>{const a=i.status!==L&&B(i);switch(i.status){case $:a&&o-i.loadErrorTime>=200&&n.push(i);break;case A:case N:a&&n.push(i);break;case x:case _:!a&&Mt(G(i))?t.push(i):a&&r.push(i);break;case I:a||e.push(i)}})),{appsToUnload:t,appsToUnmount:e,appsToLoad:n,appsToMount:r}}();let s,u=[],c=Vt,l=Vt=window.location.href;return te()?(Kt=!0,s=r.concat(i,o,a),Promise.resolve().then((()=>(d(0===s.length?"before-no-app-change":"before-app-change",m(!0)),d("before-routing-event",m(!0,{cancelNavigation:f})),Promise.all(u).then((n=>{if(n.some((t=>t)))return Ot.call(window.history,history.state,"",c.substring(location.origin.length)),Vt=location.href,Kt=!1,zt(t,e,!0);const s=r.map(_t),u=o.map(z).map((t=>t.then(_t))).concat(s),l=Promise.all(u);l.then((()=>{d("before-mount-routing-event",m(!0))}),(t=>{throw t}));const f=i.map((t=>ht(t).then((t=>Xt(t,l))))),w=a.filter((t=>i.indexOf(t)<0)).map((t=>Xt(t,l)));return l.catch((t=>{throw h(),t})).then((()=>(h(),Promise.all(f.concat(w)).catch((e=>{throw t.forEach((t=>t.reject(e))),e})).then(p).then((()=>{}),(t=>{throw t})))))})))))):(s=i,Promise.resolve().then((()=>{const t=i.map(ht);return Promise.all(t).then(h).then((()=>[])).catch((t=>{throw h(),t})).finally((()=>{}))})));function f(t=!0){const e="function"==typeof(null==t?void 0:t.then)?t:Promise.resolve(t);u.push(e.catch((t=>(console.warn(Error(T(42,!1))),console.warn(t),!1))))}function p(){const e=Rt();t.forEach((t=>t.resolve(e)));try{d(0===s.length?"no-app-change":"app-change",m()),d("routing-event",m())}catch(t){setTimeout((()=>{throw t}))}if(Kt=!1,Qt.length>0){const t=Qt;Qt=[],zt(t)}return e}function h(){n||(t.forEach((t=>{vt(t.eventArguments)})),vt(e))}function m(t=!1,n){const u={},f={[I]:[],[_]:[],[A]:[],[L]:[]};t?(i.concat(a).forEach(((t,e)=>{h(t,I)})),r.forEach((t=>{h(t,A)})),o.forEach((t=>{h(t,_)}))):s.forEach((t=>{h(t)}));const p={detail:{newAppStatuses:u,appsByNewStatus:f,totalAppChanges:s.length,originalEvent:null==e?void 0:e[0],oldUrl:c,newUrl:l}};return n&&k(p.detail,n),p;function h(t,e){const n=G(t);e=e||Lt(n),u[n]=e,(f[e]=f[e]||[]).push(n)}}function d(t,e){n||window.dispatchEvent(new y(`single-spa:${t}`,e))}}function Xt(t,e){return B(t)?q(t).then((t=>e.then((()=>B(t)?Z(t):t)))):e.then((()=>t))}let Yt=!1;function Zt(t){Yt=!0,mt&&(Tt(t),zt())}function te(){return Yt}var ee={getRawAppData:function(){return[...Ut]},reroute:zt,NOT_LOADED:A,toLoadPromise:ht,toBootstrapPromise:q,unregisterApplication:Wt,getProfilerData:function(){return V}};function ne(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function re(t,e){var n=window.getOpenmrsSpaBase().replace(/\/$/,"");return oe(t,function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})))),r.forEach((function(e){ne(t,e,n[e])}))}return t}({openmrsBase:window.openmrsBase,openmrsSpaBase:n},e)).replace(/^\/\//,"/")}function oe(t,e){return Object.keys(e).reduce((function(t,n){return t.split("${"+n+"}").join(e[n])}),t)}function ie(t){var e=t.to,n=t.templateParams,r=window.getOpenmrsSpaBase().replace(/\/$/,""),o=re(e,n).replace(window.location.origin,"");o.startsWith(r)?gt(o):window.location.assign(o)}mt&&window.__SINGLE_SPA_DEVTOOLS__&&(window.__SINGLE_SPA_DEVTOOLS__.exposedMethods=ee);var ae="openmrs:history";function se(t){var e,n=JSON.parse(null!==(e=sessionStorage.getItem(ae))&&void 0!==e?e:"[]")||[];n.push(t),n.length>50&&(n=n.slice(-50)),sessionStorage.setItem(ae,JSON.stringify(n))}function ue(){var t;0===JSON.parse(null!==(t=sessionStorage.getItem(ae))&&void 0!==t?t:"[]").length&&document.referrer&&se(document.referrer),window.addEventListener("single-spa:routing-event",(function(t){var e,n,r=ce();"replaceState"==(null===(e=t.detail.originalEvent)||void 0===e?void 0:e.singleSpaTrigger)?(r[r.length-1]=window.location.href,sessionStorage.setItem(ae,JSON.stringify(r))):!(null===(n=t.detail.originalEvent)||void 0===n?void 0:n.singleSpa)&&r.includes(window.location.href)?le({toUrl:window.location.href}):r[r.length-1]!==window.location.href&&se(window.location.href)}))}function ce(){var t;return JSON.parse(null!==(t=sessionStorage.getItem(ae))&&void 0!==t?t:"[]")}function le(t){var e=t.toUrl,n=ce(),r=n.lastIndexOf(e);if(-1==r)throw new Error("URL ".concat(e," not found in history; cannot go back to it."));var o=n.slice(0,r+1);ie({to:n[r]}),sessionStorage.setItem(ae,JSON.stringify(o))}function fe(){sessionStorage.removeItem(ae)}})(),o})())}}}));
//# sourceMappingURL=openmrs-esm-navigation.js.map